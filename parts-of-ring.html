<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <title>The Parts of Ring | LispCast</title>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@ericnormand">
    <meta name="twitter:creator" content="@ericnormand">
    <meta name="twitter:description" content="Ring, the Clojure Web library, defines three main concepts that you use to construct web applications.">
    <meta name="twitter:title" content="The Parts of Ring">

    <meta property="og:title" content="The Parts of Ring">
    <meta property="og:description" content="Ring, the Clojure Web library, defines three main concepts that you use to construct web applications.">

    <meta name="description" content="Ring, the Clojure Web library, defines three main concepts that you use to construct web applications.">

    <meta name="author" content="Eric Normand">

    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="/css/styles.css" type="text/css">

    <link rel="alternate" type="application/rss+xml"
    title="LispCast" href="/feed" />

    <!-- start Mixpanel --><script type="text/javascript">(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
      for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
                  mixpanel.init("ffad2bd88d2cb690edbbba6cf30b2958");</script><!-- end Mixpanel -->
                  </head>

  <body>
    <header class="banner">
      <h1 class="banner-logo">
        <a href="/">
          <img class="banner-logo-img"
               src="/img/Logo@2x.png"
               alt="LispCast" />
        </a>
      </h1>

      <div class="meta-data">
        <img class="bio-img"
             src="/img/eric_bio.jpg" />
        <a class="twitter-link"
           href="http://twitter.com/ericnormand">
          <i class="fa fa-twitter"></i>
        </a>
        <a class="github-link"
           href="https://github.com/ericnormand">
          <i class="fa fa-github"></i>
        </a>
        <a class="mail-link"
           href="mailto:eric@lispcast.com">
          <i class="fa fa-envelope"></i>
        </a>
        <a class="rss-link"
           href="/feed">
          <i class="fa fa-rss-square"></i>
        </a>
        <a class="rss-link"
           href="/archive.html">
          <i class="fa fa-list"></i>
        </a>
      </div>

    </header>

    <div class="main-container">


      <article class="article">
        <h2 class="article-title-wrapper">
          <a class="article-title"
             href="/parts-of-ring">
            The Parts of Ring
          </a>
        </h2>

        <div class="timestamp">
          February 18, 2015
        </div>

        
<p>Summary: <em>Ring, the Clojure Web library, defines three main concepts that you use to construct web applications.</em></p>
<p>Ring is the center of the Clojure web universe. It's not the only option in town, but the other options refer to Ring to say how they are different. <strong>Understanding Ring will help you learn any other web system in Clojure.</strong></p>
<p>Ring has three main concepts that work together to build a web application.</p>
<ol style="list-style-type: decimal">
<li>Adapters</li>
<li>Handlers</li>
<li>Middleware</li>
</ol>
<h3 id="adapters">Adapters</h3>
<center>
<img src="http://www.lispcast.com/img/adapters.jpg" />
</center>

<p>I like to think of Ring Adapters as plug adapters. When you go to a different continent, you often have to adapt the holes in the electical outlet to fit your cords. Ring Adapters let you convert different web server implementations into a standard Ring Request/Response format. That way, all of your code is standardized to the Ring format. <strong>Your code can travel into any kind of server as long as an adapter exists.</strong></p>
<p>There are Ring Adapters for many existing servers.</p>
<ul>
<li><a href="https://github.com/ring-clojure/ring/tree/master/ring-jetty-adapter">Jetty</a></li>
<li><a href="https://github.com/datskos/ring-netty-adapter">Netty</a></li>
<li><a href="https://github.com/mikejs/ring-mongrel2-adapter">Mongrel 2</a></li>
<li><a href="https://github.com/mmcgrana/ring-httpcore-adapter">Apache HttpCore</a></li>
</ul>
<p>And more. The right Ring Adapter will let your same application run in any of them.</p>
<h3 id="handlers">Handlers</h3>
<center>
<img src="http://www.lispcast.com/img/handler.png" />
</center>

<p>Handlers do the work of your application. They are like the computer. They are just Clojure functions. HTTP is basically a request/response protocol that maps well to functions, which are just a protocol from argument to return value. <strong>Handlers take a Ring Request and return a Ring Response.</strong> They should do whatever logic is necessary for your application.</p>
<h3 id="middleware">Middleware</h3>
<center>
<img src="http://www.lispcast.com/img/middleware.jpg" />
</center>

<p>Middleware are the voltage converters. Here in North America, wall sockets run at 120 volts, which is different from almost everywhere. In order to run an appliance from elsewhere, you not only need to adapt the socket, you also need to transform the current to a compatible voltage. <strong>Middleware are often used to convert the incoming request in some standard way.</strong> For instance, there is middleware to parse a JSON body into a Clojure map and store it away in the request.</p>
<p>The transformer also &quot;cleans up&quot; the current. Voltage spikes are evened out so they never get to the computer. <strong>Middleware can similarly protect a handler by making sure the browser is logged in.</strong></p>
<p>The analogy kind of breaks down, because middleware can do work (like the computer). Middleware are the hardest part of the Ring idea. They're not hard because the concept is hard. They're hard because <strong>they require design decisions</strong>. If all you had were Adapters and Handlers, you wouldn't have to think about where to put your logic. It would all go in the Handlers.</p>
<p>But there would be a lot of duplicated logic in your handlers. <strong>Authentication, routing, content-type switching, all of these things are done the same way over and over.</strong> It's the perfect problem for a little higher order programming. That's essentially what Middleware is.</p>
<p>Ring Middleware are functions that take a Handler and return a new Handler. Since Handlers are functions, <strong>Middleware are higher-order functions</strong>. The transformer on your computer's power cord takes a machine that requires a certain current and turns it into a machine that takes a different current. Middleware are used to do all sorts of things.</p>
<p>So, for instance, there's a Middleware called <a href="https://github.com/magnars/prone">Prone</a> that captures exceptions in the Handler and displays them in a nice format. Prone is a function that takes a Handler and returns a new Handler that catches exceptions and returns a different Ring Response in that case. Or you have Middleware that handle session cookies. <strong>The Middleware take a Handler and return a new Handler that understands sessions.</strong></p>
<p>My recommendation for what to put in Middleware versus what to put in Handlers is simplest to explain with a graph.</p>
<center>
<img src="http://www.lispcast.com/img/handler-middleware.png" />
</center>

<p>Along the x-axis, we have logic that ranges from HTTP logic (handling header values, query params, etc.) to business logic (which bank account to withdraw from). Along the y-axis, we have how unique the logic is, ranging from highly duplicated to custom. <strong>These are the two axes I use to figure out whether it should be in the Handler or the Middleware.</strong></p>
<p>The clear cases are easy. In the upper right corner (red dot), where it's custom business logic, <strong>it's definitely in the Handler</strong>. In the lower left (blue dot), where it's duplicated HTTP logic, I prefer Middleware. <strong>The hard part is in the middle.</strong> Somewhere between those two, there's a fine line where a <strong>case-by-case decision is required</strong>.</p>
<h3 id="conclusions">Conclusions</h3>
<p>Ring is great because it requires so few concepts to capture so much of HTTP. But it's not everything. Standard Ring does not support WebSockets, for instance. Small adaptations are necessary. In general, I think this is a great abstraction. <strong>And Ring is so central to Clojure on the Web, it's important to know.</strong></p>
<p>If you want to learn more about Ring and how to construct web applications in Clojure, you should check out <a href="http://www.purelyfunctional.tv/web-dev-in-clojure">LispCast Web Development in Clojure</a>. It's a video course designed to guide you through the major libraries used for web development. <strong>You'll learn how to build Clojure web applications from existing and custom parts.</strong> You build Middleware to make your application adapt to browser limitations. And if you sign up below, you'll get a handy Ring Spec reference sheet, which specifies the Request and Response formats.</p>
<div class="subscribe-form-wrapper">
  <form class="subscribe-form"
        action="https://lispcast.us4.list-manage.com/subscribe/post?u=a33b5228d1b5bf2e0c68a83f4&amp;id=d0f96276d9"
        method="POST"
        name="mc-embedded-subscribe-form"
        novalidate="true">
      <h3 class="subscribe-form-title">
        
Get a Free Ring Spec to hang on your wall
</h3>
    
<img class="subscribe-form-image"
         src="http://www.lispcast.com/img/ring_spec_1_3.png">
<div class="subscribe-form-text">
      <p class="subscribe-form-description">
        
Subscribe below to receive a free copy of a Ring Spec to hang on your wall. If you are programming in Ring (covered in the videos), you'll find it very useful as a reference. You'll also hear about exclusive previews and discounts of other video courses.
</p>
      
<input id="mce-EMAIL"
             class="email-field"
             type="email"
             value=""
             placeholder="Email"
             name="EMAIL"> <input type="hidden"
             name="group[18565][4]"
             value="1">
<div style="position: absolute; left: -5000px;">
        
<input type="text"
               name="b_a33b5228d1b5bf2e0c68a83f4_d0f96276d9">
</div>
      
<input class="subscribe-button"
             type="submit"
             value="Get it"
             name="subscribe">
<div class="field-text-text2">
        
No spam. Ever.
</div>
    </div>
  </form>
</div>



<h3 id="you-might-also-like">You might also like</h3>
<ul>
<li><a href="http://www.lispcast.com/cascading-separation-abstraction">Separation, Abstraction, and Cascading in CSS</a></li>
<li><a href="http://www.lispcast.com/clojure-web-security">Clojure Web Security</a></li>
<li><a href="http://www.lispcast.com/hiccup-tips">Hiccup Tips</a></li>
<li><a href="http://www.lispcast.com/json-serialization-api-clojure">JSON Serialization for APIs in Clojure</a></li>
</ul>


        <div class="endmark">
          <a class="endmark-link"
             href="/">
            <img class="endmark-lambda"
                 src="/img/dot.png" />
          </a>
        </div>

      </article>


      <div class="notes">

      </div>

    </div>

    <footer class="footer-banner">
      <a class="footer-previous"
         href="http://www.lispcast.com/object-oriented-vs-functional-duals">
        previous
      </a>
      <a class="footer-next"
         href="http://www.lispcast.com/new-course-format">
        next
      </a>
    </footer>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.0/lodash.min.js"></script>



    <script>

      document.write('<script src="https://oberon.herokuapp.com/cookie/get.js?_=' + (new Date()).getTime() + '"><\/script>');

          if(window.oberon && mixpanel) {
          if(document.cookie.indexOf('oberon-id') < 0) {
                                                    var expires = (new Date((new Date().getTime() + 1000*60*60*24*365*10))).toUTCString();
                                                    mixpanel.alias(window.oberon.id);
                                                    document.cookie = "oberon-id=" + window.oberon.id + ";expires=" + expires + ";path=/";
                                                    }
                                                    mixpanel.identify(window.oberon.id);
                                                    }

                                                    mixpanel.register({URL: window.location.pathname,
                                                    Title: $("title").text()});

                                                    mixpanel.track("Page Visit");

                                                    mixpanel.track_forms('.gazette-form', 'Submit Clojure Gazette');
                                                    mixpanel.track_forms('.subscribe-form', 'Subscribe');

                                                    mixpanel.track_links('a.homepage-offer-box-link',
                                                    'Click PurelyFunctional.tv',
                                                    function(e) {
                                                    return {ToURL: $(e).prop('href')};
                                                    });

                                                    mixpanel.track_links('a.js-clojuregazette',
                                                    'Click Clojure Gazette',
                                                    function(e) {
                                                    return {ToURL: $(e).prop('href')};
                                                    });

                                                    $('input[name=EMAIL]').change(function() {
                                                    var i = $(this);
                                                    window.o_email = i.val();
                                                    });
/*
                                                    $('form').submit(function() {
                                                    if(window.o_email)
                                                    mixpanel.people.set({"$email": window.o_email});
                                                    });*/

                                                    </script>
      <script src="/js/mylibs/annotated-code.js" defer></script>
      <script src="/js/libs/codemirror.js" defer></script>
      <link rel="stylesheet" href="/css/feedback.css" type="text/css">
      <script src="/js/mylibs/feedback.js" defer></script>

      <!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '3651717';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/3651717.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
  </body>
</html>
